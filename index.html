<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game HÃ¡i BÃ¡nh Trung Thu</title>
    <link rel="stylesheet" href="/styles.css">
  </head>
  <body>
    <div class="stars" id="stars"></div>

    <div class="container">
      <div class="header">
        <h1>ğŸ® Game HÃ¡i BÃ¡nh Trung Thu cho Äáº¡t ğŸ¥®</h1>
        <p>
          Há»©ng bÃ¡nh (+10Ä‘) - TrÃ¡nh bom (Game Over) - TÃ¬m ngÆ°á»i yÃªu (+50Ä‘ & Ä‘áº·c
          biá»‡t)!
        </p>
      </div>

      <div class="game-info">
        <div class="info-box">
          <div class="info-label">Äiá»ƒm Sá»‘</div>
          <div class="info-value" id="score">0</div>
        </div>
        <div class="info-box">
          <div class="info-label">BÃ¡nh ÄÃ£ HÃ¡i</div>
          <div class="info-value" id="cakesCollected">0</div>
        </div>
        <div class="info-box">
          <div class="info-label">Bom ÄÃ£ TrÃ¡nh</div>
          <div class="info-value" id="bombsAvoided">0</div>
        </div>
        <div class="info-box">
          <div class="info-label">NgÆ°á»i YÃªu</div>
          <div class="info-value" id="girlfriendsFound">0</div>
        </div>
        <div class="info-box">
          <div class="info-label">Thá»i Gian</div>
          <div class="info-value" id="timer">60</div>
        </div>
      </div>

      <div class="game-area" id="gameArea">
        <div id="moon"></div>
        <div class="player" id="player"></div>
        <!-- Váº­t pháº©m sáº½ Ä‘Æ°á»£c táº¡o báº±ng JavaScript -->
      </div>

      <div class="controls">
        <button id="startBtn">Báº¯t Äáº§u Game</button>
        <button id="endBtn">Káº¿t ThÃºc</button>
      </div>
    </div>

    <div class="message-overlay" id="messageOverlay">
      <div class="message-content">
        <h2 id="messageTitle">ğŸ‰ ChÃºc Má»«ng Trung Thu! ğŸ¥®</h2>
        <div class="final-score" id="finalScore">0 Ä‘iá»ƒm</div>
        <p id="messageText">ThÃ nh tÃ­ch cá»§a báº¡n tháº­t tuyá»‡t vá»i!</p>
        <p id="loveStatus">ğŸ’” Trung thu nÃ y váº«n cÃ²n Ä‘Æ¡n phÆ°Æ¡ng...</p>
        <p>ChÃºc báº¡n vÃ  gia Ä‘Ã¬nh má»™t mÃ¹a Trung Thu:</p>
        <p>
          ğŸ’« An lÃ nh - Háº¡nh phÃºc - Sum váº§y ğŸ’« <br />VÃ  Ä‘á»«ng quÃªn ib cho
          <i class="dat" style="color: #e5b990; font-weight: bold">Äáº¡t</i> Ä‘á»ƒ
          nháº­n bÃ¡nh trung thu nha!
        </p>
        <button onclick="location.reload()" style="margin-top: 20px">
          ChÆ¡i Láº¡i
        </button>
      </div>
    </div>

    <script>
      // Táº¡o sao láº¥p lÃ¡nh
      function createStars() {
        const stars = document.getElementById("stars");
        for (let i = 0; i < 100; i++) {
          const star = document.createElement("div");
          star.className = "star";
          star.style.left = Math.random() * 100 + "%";
          star.style.top = Math.random() * 100 + "%";
          star.style.width = Math.random() * 3 + "px";
          star.style.height = star.style.width;
          star.style.animationDelay = Math.random() * 5 + "s";
          stars.appendChild(star);
        }
      }

      // Khá»Ÿi táº¡o biáº¿n game
      let score = 0;
      let cakesCollected = 0;
      let bombsAvoided = 0;
      let girlfriendsFound = 0;
      let timeLeft = 60;
      let gameInterval;
      let itemInterval;
      let isGameRunning = false;
      let gameOver = false;
      let hasGirlfriend = false;

      const gameArea = document.getElementById("gameArea");
      const player = document.getElementById("player");
      const scoreDisplay = document.getElementById("score");
      const cakesDisplay = document.getElementById("cakesCollected");
      const bombsDisplay = document.getElementById("bombsAvoided");
      const girlfriendsDisplay = document.getElementById("girlfriendsFound");
      const timerDisplay = document.getElementById("timer");
      const startBtn = document.getElementById("startBtn");
      const endBtn = document.getElementById("endBtn");
      const messageOverlay = document.getElementById("messageOverlay");
      const finalScore = document.getElementById("finalScore");
      const messageTitle = document.getElementById("messageTitle");
      const messageText = document.getElementById("messageText");
      const loveStatus = document.getElementById("loveStatus");

      // Di chuyá»ƒn player theo chuá»™t
      gameArea.addEventListener("mousemove", (e) => {
        if (!isGameRunning || gameOver) return;

        const rect = gameArea.getBoundingClientRect();
        const x = e.clientX - rect.left - player.offsetWidth / 2;
        const maxX = gameArea.offsetWidth - player.offsetWidth;

        player.style.left = Math.max(0, Math.min(x, maxX)) + "px";
      });

      // Táº¡o váº­t pháº©m rÆ¡i (bÃ¡nh, bom hoáº·c ngÆ°á»i yÃªu)
      function createItem() {
        if (!isGameRunning || gameOver) return;

        const random = Math.random();
        let itemType;

        if (random < 0.09) {
          // 5% cÆ¡ há»™i lÃ  ngÆ°á»i yÃªu (hiáº¿m)
          itemType = "girlfriend";
        } else if (random < 0.35) {
          // 30% cÆ¡ há»™i lÃ  bom
          itemType = "bomb";
        } else {
          // 65% cÆ¡ há»™i lÃ  bÃ¡nh
          itemType = "cake";
        }

        const item = document.createElement("div");
        item.className = itemType;

        const maxX = gameArea.offsetWidth - 50;
        item.style.left = Math.random() * maxX + "px";
        item.style.top = "-50px";

        gameArea.appendChild(item);

        // Animation rÆ¡i (ngÆ°á»i yÃªu rÆ¡i cháº­m hÆ¡n)
        let fallSpeed =
          itemType === "girlfriend"
            ? 1 + Math.random() * 2 // NgÆ°á»i yÃªu rÆ¡i cháº­m
            : 2 + Math.random() * 5; // BÃ¡nh vÃ  bom rÆ¡i nhanh hÆ¡n

        const fallInterval = setInterval(() => {
          if (!isGameRunning || gameOver) {
            clearInterval(fallInterval);
            item.remove();
            return;
          }

          const currentTop = parseFloat(item.style.top);
          item.style.top = currentTop + fallSpeed + "px";

          // Kiá»ƒm tra va cháº¡m
          if (checkCollision(player, item)) {
            if (itemType === "bomb") {
              hitBomb(item);
              clearInterval(fallInterval);
            } else if (itemType === "cake") {
              collectCake(item);
              clearInterval(fallInterval);
            } else if (itemType === "girlfriend") {
              findGirlfriend(item);
              clearInterval(fallInterval);
            }
          }

          // XÃ³a váº­t pháº©m náº¿u ra khá»i mÃ n hÃ¬nh
          if (currentTop > gameArea.offsetHeight) {
            clearInterval(fallInterval);
            item.remove();
            // Náº¿u lÃ  bom vÃ  trÃ¡nh Ä‘Æ°á»£c thÃ¬ tÃ­nh Ä‘iá»ƒm
            if (itemType === "bomb") {
              bombsAvoided++;
              bombsDisplay.textContent = bombsAvoided;
            }
          }
        }, 20);
      }

      // Kiá»ƒm tra va cháº¡m
      function checkCollision(player, item) {
        const playerRect = player.getBoundingClientRect();
        const itemRect = item.getBoundingClientRect();

        return !(
          playerRect.right < itemRect.left ||
          playerRect.left > itemRect.right ||
          playerRect.bottom < itemRect.top ||
          playerRect.top > itemRect.bottom
        );
      }

      // Thu tháº­p bÃ¡nh
      function collectCake(cake) {
        cake.remove();
        score += 10;
        cakesCollected++;
        scoreDisplay.textContent = score;
        cakesDisplay.textContent = cakesCollected;

        showFloatingText("+10", "#ffd700", player.style.left);
      }

      // TÃ¬m tháº¥y ngÆ°á»i yÃªu
      function findGirlfriend(girlfriend) {
        girlfriend.remove();
        score += 50;
        girlfriendsFound++;
        hasGirlfriend = true;

        scoreDisplay.textContent = score;
        girlfriendsDisplay.textContent = girlfriendsFound;

        // Hiá»‡u á»©ng tÃ¬nh yÃªu
        const loveEffect = document.createElement("div");
        loveEffect.className = "love-effect";
        loveEffect.style.left = player.style.left;
        loveEffect.style.top = player.style.top;
        gameArea.appendChild(loveEffect);

        // ThÃ´ng bÃ¡o Ä‘áº·c biá»‡t
        showLoveMessage("ğŸ’– TRUNG THU NÃ€Y CÃ“ NGÆ¯á»œI YÃŠU Rá»’I! ğŸ’–");
        showFloatingText("+50", "#ff69b4", player.style.left);

        setTimeout(() => {
          loveEffect.remove();
        }, 1000);
      }

      // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o tÃ¬nh yÃªu
      function showLoveMessage(text) {
        const loveMsg = document.createElement("div");
        loveMsg.className = "mini-message";
        loveMsg.textContent = text;
        loveMsg.style.left = player.style.left;
        loveMsg.style.top = parseInt(player.style.top) - 50 + "px";
        loveMsg.style.animation = "floatUp 3s ease-out forwards";

        gameArea.appendChild(loveMsg);
        setTimeout(() => loveMsg.remove(), 5000);
      }

      // TrÃºng bom
      function hitBomb(bomb) {
        gameOver = true;

        // Hiá»‡u á»©ng ná»•
        const explosion = document.createElement("div");
        explosion.className = "explosion";
        explosion.style.left = bomb.style.left;
        explosion.style.top = bomb.style.top;
        gameArea.appendChild(explosion);

        bomb.remove();

        // Dá»«ng game sau 0.5 giÃ¢y
        setTimeout(() => {
          endGame(true);
        }, 500);
      }

      // Hiá»ƒn thá»‹ vÄƒn báº£n ná»•i
      function showFloatingText(text, color, left) {
        const points = document.createElement("div");
        points.textContent = text;
        points.style.position = "absolute";
        points.style.color = color;
        points.style.fontSize = "20px";
        points.style.fontWeight = "bold";
        points.style.left = left;
        points.style.top = parseInt(player.style.top) - 30 + "px";
        points.style.animation = "floatUp 1s ease-out forwards";
        points.style.zIndex = "5";

        gameArea.appendChild(points);
        setTimeout(() => points.remove(), 1000);
      }

      // Báº¯t Ä‘áº§u game
      startBtn.addEventListener("click", startGame);

      function startGame() {
        if (isGameRunning) return;

        isGameRunning = true;
        gameOver = false;
        hasGirlfriend = false;
        score = 0;
        cakesCollected = 0;
        bombsAvoided = 0;
        girlfriendsFound = 0;
        timeLeft = 60;

        scoreDisplay.textContent = score;
        cakesDisplay.textContent = cakesCollected;
        bombsDisplay.textContent = bombsAvoided;
        girlfriendsDisplay.textContent = girlfriendsFound;
        timerDisplay.textContent = timeLeft;

        // Táº¡o váº­t pháº©m má»—i 0.8 giÃ¢y
        itemInterval = setInterval(createItem, 800);

        // Äáº¿m ngÆ°á»£c thá»i gian
        gameInterval = setInterval(() => {
          timeLeft--;
          timerDisplay.textContent = timeLeft;

          if (timeLeft <= 0) {
            endGame(false);
          }
        }, 1000);
      }

      // Káº¿t thÃºc game
      endBtn.addEventListener("click", () => endGame(false));

      function endGame(isBombGameOver) {
        isGameRunning = false;
        gameOver = true;
        clearInterval(gameInterval);
        clearInterval(itemInterval);

        // Hiá»ƒn thá»‹ thÃ´ng Ä‘iá»‡p phÃ¹ há»£p
        if (isBombGameOver) {
          messageTitle.innerHTML =
            'ğŸ’¥ <span class="game-over">Game Over!</span> ğŸ’¥';
          messageText.textContent = "Ã”i khÃ´ng! Báº¡n Ä‘Ã£ trÃºng bom!";
        } else {
          messageTitle.innerHTML = "ğŸ‰ ChÃºc Má»«ng Trung Thu! ğŸ¥®";
          messageText.textContent = "ThÃ nh tÃ­ch cá»§a báº¡n tháº­t tuyá»‡t vá»i!";
        }

        // ThÃ´ng bÃ¡o tÃ¬nh tráº¡ng tÃ¬nh yÃªu
        if (hasGirlfriend) {
          loveStatus.innerHTML =
            'ğŸ’– <span class="love-message">Trung thu nÃ y cÃ³ ngÆ°á»i yÃªu rá»“i! Yay!</span> ğŸ’–';
        } else {
          loveStatus.innerHTML = "ğŸ’” Trung thu nÃ y váº«n cÃ²n Ä‘Æ¡n phÆ°Æ¡ng...";
        }

        finalScore.textContent = score + " Ä‘iá»ƒm";
        messageOverlay.style.display = "flex";

        // XÃ³a táº¥t cáº£ váº­t pháº©m cÃ²n láº¡i
        document
          .querySelectorAll(".cake, .bomb, .girlfriend")
          .forEach((item) => item.remove());
      }

      // ThÃªm CSS cho hiá»‡u á»©ng
      const style = document.createElement("style");
      style.textContent = `
            @keyframes floatUp {
                0% { transform: translateY(0); opacity: 1; }
                100% { transform: translateY(-50px); opacity: 0; }
            }
        `;
      document.head.appendChild(style);

      // Khá»Ÿi táº¡o game
      createStars();

      // Äáº·t vá»‹ trÃ­ player ban Ä‘áº§u
      player.style.left =
        gameArea.offsetWidth / 2 - player.offsetWidth / 2 + "px";
    </script>
  </body>
</html>
